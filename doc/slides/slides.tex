\documentclass{beamer}

\usepackage[francais]{babel}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{color}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage[adobe-utopia]{mathdesign}

\newcommand{\deriv}{\partial \!}

% Couleurs inspirées de famfamfam.com
\definecolor{vert}{HTML}{59FF2D}
\definecolor{bleu}{HTML}{0BCEFF}
\definecolor{rose}{HTML}{FF0B5B}
\definecolor{gris}{gray}{0.5}

\usetikzlibrary{shapes,fit,calc,3d}

\tikzset{line/.style={
    shorten >= -#1,
    shorten <= -#1}}
\tikzset{halfline/.style={
    shorten >= -#1}}
\tikzset{axe/.style={
    ->,
    thin}}
\tikzset{fig/.style={
    thick}}
\tikzset{origine/.style={
    draw=black,
    cross out}}
\tikzset{aabb/.style={
    dashed,
    thick,
    inner sep=0}}
\tikzset{gjknode/.style={
    fill=rose,
    circle}}
\tikzset{gjkedge/.style={
    draw=rose,
    thick}}
\tikzset{gjkdir/.style={
    halfline=0.5cm,
    draw=gris,
    very thick,
    dashed}}
\tikzset{gjkclosest/.style={
    circle,
    fill=bleu}}
\tikzset{rayon/.style={
    ->,
    dashed,
    draw=gris}}

\title{Simulation physique de corps rigides avec interaction}
\author{Merwan Achibet}
\date{}

\begin{document}

\shorthandoff{!} % Pour éviter bug de Tikz + Babel french

\begin{frame}
  \maketitle
\end{frame}

\section{Introduction}

\begin{frame}{Moteur physique ?}
  Moteur physique : système de simulation mécanique
  \begin{description}
  \item[Industrie, science, cinéma] précis, coûteux 
  \item[Jeu vidéo, réalité virtuelle] approximatifs, temps réel
  \end{description}

  \vfill
  
  Ce projet :
  \begin{itemize}
  \item Moteur physique de base 
  \item Corps rigides
  \item Corps convexes
  \item Temps réel
  \end{itemize}
\end{frame}

\begin{frame}{\'Etude de cas}
  \begin{enumerate}
    \item
      La chute

      \begin{align*}
        \vec{a} = \frac{1}{m} \sum_i \vec{F}_i
      \end{align*}
    \item
      Le rebond

      \begin{align*}
        &\vec{v}_1 = \gamma \vec{v}_2
      \end{align*}
    \item
      Le repos

      \begin{align*}
        &\vec{F}_{A/B} = -\vec{F}_{B/A} \\
        &\vec{F}_{A/B} + \vec{F}_{B/A} = 0
      \end{align*}
  \end{enumerate}
\end{frame}

\begin{frame}{Modules}
  Différentes tâches :
  \begin{itemize}
  \item Dynamique
    \begin{itemize}
      \item Mouvement linéaire
      \item Mouvement angulaire
    \end{itemize}
  \item Gestion des collisions
    \begin{itemize}
    \item Détection
    \item Correction
    \item Réponse
    \end{itemize}
  \end{itemize}
\end{frame}

\section{Dynamique}

\begin{frame}{La composante linéaire}
  \begin{itemize}
    \item Entrée : forces environnementales
    \item Sortie : changement de position
  \end{itemize}

  \begin{align*}
    \vec{v} &= \frac{\deriv \vec{p}}{\deriv t} \\
    \vec{a} &= \frac{\deriv \vec{v}}{\deriv t}
  \end{align*}

  \begin{align*}
    \vec{p} = \int \vec{v}\; \deriv t \\
    \vec{v} = \int \vec{a}\; \deriv t
  \end{align*}

\end{frame}

\begin{frame}{Intégration approximée}
  Intégration d'Euler :
  \begin{align*}
    x_{n+1} = x_{n} + x' \deriv t
  \end{align*}

  \vfill

  Appliquée à nos besoins :
  \begin{align*}
    \vec{a}_{n+1} &= \frac{1}{m} \sum_i \vec{F}_i \\ \\
    \vec{v}_{n+1} &= \vec{v}_n + \vec{a}_{n+1} \deriv t \\ \\
    \vec{p}_{n+1} &= \vec{p}_n + \vec{v}_{n+1} \deriv t
  \end{align*}
\end{frame}

\begin{frame}{Simplification grâce à l'élan linéaire}
  \begin{align*}
    \sum_i \vec{F}_i = \frac{\deriv \vec{L}}{\deriv t} = \frac{\deriv (m\vec{v})}{\deriv t}
  \end{align*}

  \begin{align*}
    \vec{L}_{n+1} &= \vec{L}_n + {\sum_i \vec{F}_i} \\ \\
    \vec{p}_{n+1} &= \vec{p}_n + \frac{1}{m}\vec{L}_{n+1} \deriv t
  \end{align*}
\end{frame}

\begin{frame}{Modélisation d'un corps}
  OK pour une particule, mais un objet plus complexe ?
  \begin{description}
    \item[Une particule = un sommet] Non
    \item[Une unique particule judicieusement placée] Oui, le centre de masse
  \end{description}

  \vfill

  \begin{align*}
    \vec{C} = \frac{1}{M} \sum_i m_i \vec{p}_i
  \end{align*}
\end{frame}

\begin{frame}{Le centre de masse}
  Centre de masse = origine du repère local

  \vfill

  \begin{figure}
    \input{images/reperelocal.tikz}
  \end{figure}

  \vfill

  \begin{align*}
    \vec{p}_l = \vec{p}_a - \vec{C}
  \end{align*}
\end{frame}

\begin{frame}{La composante angulaire}
  Il manque quelque chose... Les rotations !

  \begin{description}
    \item[Orientation]
      Une matrice : un vecteur colonne = un axe du repère local
      \begin{align*}
        \begin{pmatrix}
          1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1
        \end{pmatrix}
        \rightarrow
        \begin{pmatrix}
          1 \\ 0 \\ 0
        \end{pmatrix}
        \begin{pmatrix}
          0 \\ 1 \\ 0
        \end{pmatrix}
        \begin{pmatrix}
          0 \\ 0 \\ 1
        \end{pmatrix}
      \end{align*}
      
    \item[\'Elan angulaire]
      Analogue à l'élan linéaire
      \begin{align*}
        \vec{A}_{n+1} &= \vec{A}_n + {\sum_i \vec{\tau}_i} \\
        \vec{\tau}_i &= (\vec{x} - \vec{C}) \times \vec{F}_i
      \end{align*}
  \end{description}
\end{frame}

\begin{frame}
  quantités auxiliaires
\end{frame}

\section{Collisions}

\subsection{Détection}

\begin{frame}{Deux niveaux de précision}
  On teste les collisions entre paires de corps : $\frac{n(n-1)}{2}$ tests

  \begin{enumerate}
    \item Détection grossière
    \item Détection fine
  \end{enumerate}
\end{frame}

\begin{frame}{Détection grossière I}
  \begin{figure}
    \centering
    \input{images/boundingboxes1.tikz}
  \end{figure}

  \begin{description}
    \item[Boîte englobante] Contient tous les points d'un corps
    \item[SAT] Test de collision rapide
  \end{description}
\end{frame}

\begin{frame}{Détection grossière II}
  \begin{figure}
    \centering
    \input{images/boundingboxes2.tikz}
  \end{figure}

  \begin{itemize}
    \item Résultat positif quand deux corps s'interpénètrent, mais aussi parfois quand ce n'est pas le cas.
    \item La détection fine validera/infirmera la collision
  \end{itemize}
\end{frame}

\begin{frame}{Détection grossière III}
  \begin{figure}
    \centering
    \input{images/boundingboxes3.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Détection fine I}
  \begin{description}
    \item[Somme de Minkowski]
      $A \oplus B = \{a + b \mid a \in A, b \in B\}$
    \item[Différence de Minkowski]
      $A \ominus B = A \oplus (-B)$
  \end{description}

  \begin{figure}
    \centering
    \input{images/minkowski1.tikz}
    \input{images/minkowski2.tikz}
  \end{figure}

  \begin{description}
    \item[Particularité]
      la plus petite distance de la différence de Minkowski à l'origine est la plus petite distance entre les corps $A$ et $B$
  \end{description}
\end{frame}

\begin{frame}{Détection fine II}
  Comment calculer la plus petite distance entre $M$ et l'origine ?

  Un simplex :
  \begin{description}
    \item[1] Sommet
    \item[2] Arête
    \item[3] Triangle
    \item[4] Tétraèdre
  \end{description}

  Une fonction de support :
\end{frame}

\begin{frame}{détection fine III}
  \begin{figure}
    \centering
    \input{images/gjk1a.tikz}
    \input{images/gjk1b.tikz}
    \input{images/gjk2a.tikz}
    \input{images/gjk2b.tikz}
    \input{images/gjk3a.tikz}
    \input{images/gjk3b.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Correction I}
  \begin{description}
    \item[Simulation discrète] Pas de temps fixe
    \item[Problème] Les collisions sont toujours pénétrantes
  \end{description}

  \vfill

  \begin{figure}
    \centering
    \input{images/interpenetration.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Correction II}
 \begin{description}
    \item[Solution] Intégrer en arrière, par dichotomie
  \end{description}

  \begin{figure}
    \centering
    \input{images/dichotomie.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Réponse I}
  Un corps rigide :
  \begin{itemize}
  \item Sommets
  \item Arêtes
  \item Faces
  \end{itemize}

  On s'intéresse uniquement aux contacts sommet-face et arête-arête.

  \begin{figure}
    \centering
    \input{images/contacts1.tikz}
    \input{images/contacts2.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Réponse II}
  Un \textit{contact} :
  \begin{itemize}
  \item Position
  \item Normale
  \item Temps
  \end{itemize}

  \vfill

  Un contact = une \textit{impulsion}
  \begin{align*}
    J = \vec{n} 
    \frac{-(1 + \varepsilon) v_r}{
      \frac{1}{m_A} +
      \frac{1}{m_B} +
      \vec{n}
      (I_A^{-1} (\vec{r}_A \times \vec{n})) \times \vec{r}_A +
      (I_B^{-1} (\vec{r}_b \times \vec{n})) \times \vec{r}_B
    }
  \end{align*}
\end{frame}

\section{Le moteur}

\subsection{Algorithme principal}

\begin{frame}{Algorithme}
  \begin{enumerate}
  \item
    Détection de collision
    \begin{enumerate}
      \item Détection grossière
      \item Détection fine
      \item Recherche des contacts
      \item Application d'impulsions
    \end{enumerate}
  \item Application de forces environnementales
  \item intégration
  \end{enumerate}

  défauts
\end{frame}

\begin{frame}{Algorithme amélioré}

  mieux
\end{frame}

\subsection{Démonstrations}

\begin{frame}{Démonstrations}
  \begin{figure}
    \includegraphics[width=5cm]{images/box.jpg}
    \includegraphics[width=5cm]{images/pachinko.jpg}
  \end{figure}
\end{frame}

\subsection{Perspectives d'évolution}

\begin{frame}{Tunneling I}
  Toujours à cause de l'intégration discrète :
  \begin{figure}
    \centering
    \input{images/tunneling1.tikz}
  \end{figure}

  Les corps se traversent mais aucune collision n'est détectée !
\end{frame}

\begin{frame}{Tunneling II}
  \begin{figure}
    \centering
    \input{images/tunneling2.tikz}
    \input{images/tunneling3.tikz}
  \end{figure}
\end{frame}

\begin{frame}{Partitionnement de l'espace}
  \begin{figure}
    \centering
    \input{images/tunneling1.tikz}
    \input{images/tunneling2.tikz}
    \input{images/tunneling3.tikz}
  \end{figure}
\end{frame}

\section{conclusion}

\begin{frame}{Conclusion}
  
\end{frame}

\end{document}
